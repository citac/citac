#!/usr/bin/env ruby

require 'puppet/util/command_line'
require_relative '../lib/citac/puppet/patches'

def run_puppet(args = ARGV)
  cmd = Puppet::Util::CommandLine.new 'puppet', args
  cmd.execute
end

if ARGV.size > 0 && ARGV[0] == 'apply'
  args = ARGV.dup
  args << '--detailed-exitcodes' unless args.include? '--detailed-exitcodes'

  begin
    run_puppet args
  rescue SystemExit => e
    exit 0 if e.status == 2
    exit e.status
  end
else
  run_puppet
end